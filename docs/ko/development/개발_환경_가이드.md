# 개발 환경 가이드

## 📋 개요

SpaceONE Google Cloud Billing Cost Datasource 플러그인의 **개발 환경 설정, 서버 실행, 문서 작성**에 대한 통합 가이드입니다.

**마지막 업데이트**: 2025년 10월 2일 (v1.0.9 기준)

---

## 🛠️ 개발 환경 설정

### 시스템 요구사항
- **OS**: macOS, Linux, Windows
- **Python**: 3.8 이상 (권장: 3.9+)
- **메모리**: 최소 4GB (권장: 8GB+)
- **디스크**: 최소 2GB 여유 공간

### 환경 설정 단계

#### 1. 프로젝트 클론 및 이동
```bash
git clone <repository-url>
cd plugin-google-billing-cost-datasource
```

#### 2. 가상환경 생성 및 활성화
```bash
# 가상환경 생성
python3 -m venv venv

# 가상환경 활성화
# Linux/Mac:
source venv/bin/activate
# Windows:
venv\Scripts\activate
```

#### 3. 의존성 설치
```bash
# 기본 의존성 설치
pip install -r pkg/pip_requirements.txt

# 개발 도구 설치
pip install ruff pytest coverage mypy
```

#### 4. 환경 변수 설정
```bash
# 환경 템플릿 복사
cp examples/environment-variables-template.env .env

# 실제 값으로 편집
vim .env

# 적절한 권한 설정
chmod 600 .env
```

### 개발 도구 설정

#### IDE 설정 (VS Code 권장)
```json
// .vscode/settings.json
{
    "python.defaultInterpreter": "./venv/bin/python",
    "python.linting.enabled": true,
    "python.linting.ruffEnabled": true,
    "python.formatting.provider": "ruff",
    "python.testing.pytestEnabled": true
}
```

#### Git 설정
```bash
# Git hooks 설정 (선택사항)
cp scripts/pre-commit .git/hooks/
chmod +x .git/hooks/pre-commit
```

---

## 🚀 서버 실행 가이드

### 실행 전 체크리스트

#### 1. 포트 상태 확인
```bash
# 현재 프로젝트 포트(50051) 확인
lsof -i :50051

# 포트 사용 중인 경우 정리
if lsof -i :50051 > /dev/null 2>&1; then
    echo "50051 포트 사용 중인 프로세스 발견, 정리 중..."
    kill -9 $(lsof -ti :50051)
else
    echo "50051 포트 사용 가능"
fi
```

#### 2. 환경 변수 확인
```bash
# 필수 환경 변수 확인
echo "GOOGLE_APPLICATION_CREDENTIALS: $GOOGLE_APPLICATION_CREDENTIALS"
echo "DEBUG: $DEBUG"
echo "LOG_LEVEL: $LOG_LEVEL"
```

#### 3. 의존성 확인
```bash
# 가상환경 활성화 확인
which python  # venv/bin/python이어야 함

# 필수 패키지 확인
pip list | grep -E "(spaceone|google-cloud|pandas)"
```

### 서버 실행

#### 기본 실행
```bash
# 개발 모드 실행
python src/plugin/main.py

# 또는 모듈로 실행
python -m plugin.main
```

#### 디버그 모드 실행
```bash
# 환경 변수로 디버그 모드 활성화
DEBUG=true LOG_LEVEL=DEBUG python src/plugin/main.py
```

#### 백그라운드 실행
```bash
# 백그라운드 실행
nohup python src/plugin/main.py > server.log 2>&1 &

# 프로세스 확인
ps aux | grep main.py
```

### 서버 상태 확인

#### 헬스 체크
```bash
# gRPC 서버 연결 테스트
grpcurl -plaintext localhost:50051 list

# 기본 API 테스트
grpcurl -plaintext -d '{}' localhost:50051 spaceone.api.cost_analysis.plugin.DataSource/init
```

#### 로그 모니터링
```bash
# 실시간 로그 확인
tail -f server.log

# 에러 로그만 확인
tail -f server.log | grep ERROR
```

---

## 📝 문서 작성 가이드

### 문서 구조 및 표준

#### 디렉토리 구조
```
docs/ko/
├── development/     # 개발 가이드
├── technical/       # 기술 문서
├── user-guide/      # 사용자 가이드
└── operations/      # 운영 가이드
```

#### 문서 명명 규칙
- **한국어 사용**: 파일명과 제목 모두 한국어
- **언더스코어 사용**: `개발_환경_가이드.md`
- **명확한 제목**: 내용을 정확히 반영하는 제목

### 문서 작성 표준

#### 마크다운 스타일
```markdown
# 제목 (H1) - 문서당 1개만

## 주요 섹션 (H2)

### 하위 섹션 (H3)

#### 세부 항목 (H4)

- 목록 항목
  - 하위 항목

**강조 텍스트**
*기울임 텍스트*
`코드 텍스트`
```

#### 코드 블록
```bash
# 쉘 명령어
command --option value
```

```python
# Python 코드
def example_function():
    return "Hello, World!"
```

```yaml
# YAML 설정
options:
  key: value
```

#### 주의사항 및 경고
```markdown
> **주의**: 중요한 정보

> **경고**: 위험한 작업

> **팁**: 유용한 정보
```

### 문서 품질 기준

#### 필수 포함 사항
- **목차**: 긴 문서는 목차 포함
- **개요**: 문서의 목적과 범위
- **예제**: 실제 사용 가능한 예제
- **업데이트 날짜**: 마지막 수정 날짜

#### 검토 체크리스트
- [ ] 맞춤법 및 문법 확인
- [ ] 링크 유효성 확인
- [ ] 코드 예제 테스트
- [ ] 스크린샷 최신성 확인
- [ ] 버전 정보 업데이트

---

## 🔧 개발 워크플로우

### 일반적인 개발 절차

#### 1. 새 기능 개발
```bash
# 1. 브랜치 생성
git checkout -b feature/new-feature

# 2. 개발 환경 확인
source venv/bin/activate
python --version

# 3. 코드 작성
# ... 개발 작업 ...

# 4. 테스트 실행
pytest test/

# 5. 코드 품질 검사
ruff check src/
ruff format src/

# 6. 커밋 및 푸시
git add .
git commit -m "feat: add new feature"
git push origin feature/new-feature
```

#### 2. 버그 수정
```bash
# 1. 문제 재현
python src/plugin/main.py
# ... 버그 확인 ...

# 2. 수정 작업
# ... 코드 수정 ...

# 3. 테스트 확인
pytest test/test_specific.py -v

# 4. 회귀 테스트
pytest test/ --cov=src
```

### 코드 리뷰 준비

#### 체크리스트
- [ ] 모든 테스트 통과
- [ ] 코드 스타일 준수 (ruff)
- [ ] 타입 힌트 추가 (mypy)
- [ ] 문서 업데이트
- [ ] 커밋 메시지 명확성

#### PR 템플릿
```markdown
## 변경 사항
- 기능 추가/수정/삭제 내용

## 테스트
- [ ] 단위 테스트 추가/수정
- [ ] 통합 테스트 확인
- [ ] 수동 테스트 완료

## 체크리스트
- [ ] 코드 스타일 검사 통과
- [ ] 문서 업데이트 완료
- [ ] 하위 호환성 확인
```

---

## 🚨 문제 해결

### 자주 발생하는 문제

#### 1. 포트 충돌
```bash
# 문제: Address already in use
# 해결: 포트 사용 프로세스 종료
lsof -ti :50051 | xargs kill -9
```

#### 2. 의존성 충돌
```bash
# 문제: Package conflicts
# 해결: 가상환경 재생성
rm -rf venv
python3 -m venv venv
source venv/bin/activate
pip install -r pkg/pip_requirements.txt
```

#### 3. 인증 오류
```bash
# 문제: Google Cloud 인증 실패
# 해결: 서비스 계정 키 확인
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account.json"
gcloud auth application-default login
```

#### 4. 메모리 부족
```bash
# 문제: Out of memory
# 해결: 배치 크기 조정
# src/plugin/conf/cost_conf.py에서 chunk_size 감소
```

### 로그 분석

#### 일반적인 에러 패턴
```bash
# gRPC 연결 오류
grep "failed to connect" server.log

# 인증 오류
grep "authentication" server.log

# 메모리 오류
grep -i "memory\|oom" server.log

# 성능 이슈
grep "timeout\|slow" server.log
```

---

## 📚 참고 자료

### 내부 문서
- [코드 품질 가이드](코드_품질_가이드.md)
- [테스트 가이드](테스트_가이드.md)
- [성능 최적화 가이드](성능_최적화_가이드.md)
- [SpaceONE 호환성 가이드](SpaceONE_호환성_가이드.md)

### 외부 자료
- [Python 가상환경 가이드](https://docs.python.org/3/tutorial/venv.html)
- [gRPC Python 튜토리얼](https://grpc.io/docs/languages/python/)
- [Google Cloud Python SDK](https://cloud.google.com/python/docs)
- [SpaceONE 개발자 문서](https://spaceone-dev.gitbook.io/)

---

**마지막 업데이트**: 2025년 10월 2일  
**작성자**: SpaceONE Team  
**버전**: v1.0.9
